version: 2
jobs:
  pull-and-build:
    working_directory: ~/ringsavvy-website
    docker:
      - image: cimg/node:12.22.7
    steps:
      - checkout
      - restore_cache:
          keys: 
            - npm-cache-v1-{{ checksum "package-lock.json" }}
            - v1-dependencies-
      - add_ssh_keys:
          fingerprints:
            - '40:b2:a1:00:6f:75:26:b3:bb:b7:4f:4e:53:37:e2:8f'
            - '97:73:ed:06:2f:29:97:e6:1d:12:3e:fc:ba:ed:82:23'
            - '83:1e:ce:f5:22:9c:c2:ef:d2:55:ab:11:54:ca:80:a4'
      - run:
          name: Install Dependencies
          command: npm ci
      - save_cache:
          key: npm-cache-v1-{{ checksum "package-lock.json" }}
          paths:
            - node_modules
      - run:
          name: Run build
          command: npm run build

      - run: sudo apt-get install rsync -y

      - run: 
          name: create zip 
          command: zip -r ~/ringsavvy-website/build.zip build

      - store_artifacts:
          path: ~/ringsavvy-website/dist.zip
          destination: dist.zip

      # - run: ssh-keyscan -H $SSH_HOST >> ~/.ssh/known_hosts

      # Finally, upload your files to server.
      # - run: 
      #     name: deploy
      #     command: rsync -avce ssh --delete ./dist/ $USER@$SSH_HOST:2020/home/ringsavvy/repositories/ringsavvy-website/


      


workflows:
  version: 2
  build-project:
    jobs:
      - pull-and-build:
          filters:
            branches:
              only:
                - feature/circleci-cicd